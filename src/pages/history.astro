---
import Layout from '../layouts/Layout.astro';
import { timeline, majorEvents, eras } from '../data/history.json';

// ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’å®šç¾©
const typeIcons = {
  all: 'ğŸ“™',
  server: 'ğŸ–¥ï¸',
  nation: 'ğŸ‘‘',
  conflict: 'âš”ï¸',
  diplomacy: 'ğŸ¤',
  default: 'ğŸ“œ'
};

// æ™‚ä»£åŒºåˆ†ã®è‰²ã‚’å®šç¾©
const eraColors = {
  'å‰µè¨­æœŸ': 'bg-amber-50 border-amber-200',
  'å‹•ä¹±æœŸ': 'bg-rose-50 border-rose-200',
  default: 'bg-gray-50 border-gray-200'
};
---

<Layout title="æ­´å² - ã‹ã‚Earth Wiki">
	<head>
  		<title>ã€å…¬å¼ã€‘ã‹ã‚Earth Wiki</title>
  		<meta name="description" content="ã‹ã‚Earthã®å…¬å¼Wikiã§ã™ã€‚æ§˜ã€…ãªæƒ…å ±ãŒè¼‰ã£ã¦ã„ã¾ã™" />
  		<meta name="robots" content="index, follow" /> <!-- ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨±å¯ -->
  		<meta property="og:title" content="ã€å…¬å¼ã€‘ã‹ã‚Earth Wiki" />
  		<meta property="og:description" content="ã‹ã‚Earthã®å…¬å¼Wikiã§ã™ã€‚æ§˜ã€…ãªæƒ…å ±ãŒè¼‰ã£ã¦ã„ã¾ã™" />
  		<meta property="og:type" content="website" />
  		<meta property="og:url" content="https://wiki.karoearth.xyz" />
  	  <meta property="og:image" content="https://wiki.karoearth.xyz/src/images/title.png" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>

  <div class="prose max-w-none">
    <h1 class="text-4xl font-bold mb-8 text-center">ã‹ã‚Earthã®æ­´å²</h1>

    <div class="space-y-12">
      <!-- æ™‚ä»£åŒºåˆ†ã®æ¦‚è¦ -->
      <section class="bg-white p-8 rounded-lg shadow-md">
        <h2 class="text-3xl font-bold mb-6 text-center border-b-2 border-gray-200 pb-4">æ™‚ä»£åŒºåˆ†</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {eras.map((era) => (
            <div class={`p-6 rounded-lg border-2 ${eraColors[era.name] || eraColors.default}`}>
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-bold">{era.name}</h3>
                <span class="text-sm text-gray-600 font-serif">
                  {era.startDate} ï½ {era.endDate}
                </span>
              </div>
              <p class="text-gray-700 leading-relaxed">{era.description}</p>
            </div>
          ))}
        </div>
      </section>

      <!-- ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—é¸æŠ -->
      <section class="bg-white p-8 rounded-lg shadow-md">
        <h2 class="text-3xl font-bold mb-6 text-center border-b-2 border-gray-200 pb-4">ç¨®é¡ã§çµã‚Šè¾¼ã‚€</h2>
        <div class="flex justify-center gap-4 mb-8">
          {Object.keys(typeIcons).map((type) => (
            <button
              class={`px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors`}
              data-type={type}
              id={`filter-${type}`}
            >
              {typeIcons[type]} {type}
            </button>
          ))}
        </div>
      </section>

      <!-- å¹´è¡¨ -->
      <section class="bg-white p-8 rounded-lg shadow-md">
        <h2 class="text-3xl font-bold mb-6 text-center border-b-2 border-gray-200 pb-4">å¹´è¡¨</h2>

        <div class="max-w-4xl mx-auto" id="timeline-container">
          {eras.map((era) => (
            <div id={`era-${era.id}`} class="mb-12">
              <div class="sticky top-4 z-10 bg-white shadow-sm">
                <div class={`p-4 rounded-lg ${eraColors[era.name] || eraColors.default} mb-6`}>
                  <h3 class="text-2xl font-bold text-center">{era.name}</h3>
                  <p class="text-center text-sm text-gray-600 font-serif">
                    {era.startDate} ï½ {era.endDate}
                  </p>
                </div>
              </div>

              <div class="space-y-8" id={`era-${era.id}-events`}>
                {timeline
                  .filter(event => event.era === era.name)
                  .map((event, index) => (
                    <div class="relative" data-type={event.type}>
                      <div class="absolute left-24 top-0 bottom-0 w-px bg-gray-200"></div>
                      <div class="relative flex gap-8 group">
                        <!-- æ—¥ä»˜ -->
                        <div class="w-48 flex-shrink-0 pt-2">
                          <div class="text-lg font-serif text-gray-600 text-right pr-8">
                            {event.date}
                          </div>
                        </div>

                        <!-- ã‚¤ãƒ™ãƒ³ãƒˆå†…å®¹ -->
                        <div class="flex-grow pb-8">
                          <div class="relative">
                            <!-- ãƒãƒ¼ã‚«ãƒ¼ -->
                            <div class="absolute -left-11 top-3 w-6 h-6 rounded-full bg-white border-4 border-gray-300 group-hover:border-gray-400 transition-colors"></div>
                            
                            <div class="bg-white border-2 border-gray-100 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow">
                              <div class="flex items-center gap-3 mb-3">
                                <span class="text-2xl" role="img" aria-label={event.type}>
                                  {typeIcons[event.type] || typeIcons.default}
                                </span>
                                <h4 class="text-xl font-bold">{event.title}</h4>
                              </div>
                              
                              <div class="pl-10 space-y-2">
                                <p class="text-gray-600 leading-relaxed">
                                  {event.description.split("\n").map((line, index) => (
                                    <>
                                      {line}
                                      {index < event.description.split("\n").length - 1 && <br />}
                                    </>
                                  ))}
                                </p>
                                {event.involvedParties && (
                                  <p class="text-sm text-gray-500">
                                    <span class="font-medium">é–¢ä¿‚å›½ï¼š</span>
                                    {event.involvedParties.join('ã€')}
                                  </p>
                                )}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- é‡è¦ãªå‡ºæ¥äº‹ -->
      <section class="bg-white p-8 rounded-lg shadow-md">
        <h2 class="text-3xl font-bold mb-6 text-center border-b-2 border-gray-200 pb-4">é‡è¦ãªå‡ºæ¥äº‹</h2>
        <div class="max-w-4xl mx-auto space-y-8">
          {majorEvents.map((event) => (
            <article class="border-2 border-gray-100 rounded-lg p-6 hover:shadow-md transition-shadow">
              <div class="flex items-center gap-4 mb-4">
                <div class="w-16 h-16 flex items-center justify-center bg-gray-100 rounded-full">
                  <span class="text-2xl">ğŸ“–</span>
                </div>
                <div>
                  <h3 class="text-2xl font-bold">{event.title}</h3>
                  <p class="text-gray-600 font-serif">{event.date}</p>
                </div>
              </div>
              <div class="pl-20 space-y-3">
                <p class="text-gray-700 leading-relaxed">{event.description}</p>
                <div class="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span class="font-medium">å ´æ‰€ï¼š</span>
                    <span class="text-gray-600">{event.location}</span>
                  </div>
                  <div>
                    <span class="font-medium">å‚åŠ è€…ï¼š</span>
                    <span class="text-gray-600">{event.participants.join('ã€')}</span>
                  </div>
                </div>
                <div class="pt-2">
                  <span class="font-medium">å½±éŸ¿ï¼š</span>
                  <p class="text-gray-600 mt-1">{event.impact}</p>
                </div>
              </div>
            </article>
          ))}
        </div>
      </section>
    </div>
  </div>

  <script>
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
    document.addEventListener('DOMContentLoaded', function () {
      function filterEvents(event) {
        const selectedType = event.target.dataset.type;
        const timelineContainer = document.getElementById('timeline-container');
        const events = timelineContainer.querySelectorAll('[data-type]');
        
        events.forEach((eventElement) => {
          if (selectedType === 'all' || eventElement.dataset.type === selectedType) {
            eventElement.style.display = 'block';
          } else {
            eventElement.style.display = 'none';
          }
        });
      }

      // ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
      const buttons = document.querySelectorAll('button[data-type]');
      buttons.forEach((button) => {
        button.addEventListener('click', filterEvents);
      });
    });
  </script>
</Layout>